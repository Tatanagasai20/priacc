pipeline {
    agent any

    environment {
        REMOTE_HOST = "ubuntu@<EC2-2-IP>"  // Replace with Docker server IP
        CREDENTIALS_ID = 'docker-server-key'
        FRONTEND_DIR = 'frontend'
        BACKEND_DIR = 'backend'
    }

    stages {
        stage('Clone') {
            steps {
                git 'https://github.com/<your-username>/PriaccEnterprise.AI.git'
            }
        }

        stage('Build & Deploy Frontend') {
            steps {
                sshagent([CREDENTIALS_ID]) {
                    sh """
                    scp -r $FRONTEND_DIR $REMOTE_HOST:/home/ubuntu/
                    ssh $REMOTE_HOST 'cd /home/ubuntu/$FRONTEND_DIR && docker build -t frontend-app . && docker run -d -p 3000:3000 frontend-app'
                    """
                }
            }
        }

        stage('Build & Deploy Backend') {
            steps {
                sshagent([CREDENTIALS_ID]) {
                    sh """
                    scp -r $BACKEND_DIR $REMOTE_HOST:/home/ubuntu/
                    ssh $REMOTE_HOST 'cd /home/ubuntu/$BACKEND_DIR && docker build -t backend-app . && docker run -d -p 8080:8080 backend-app'
                    """
                }
            }
        }
    }
}

